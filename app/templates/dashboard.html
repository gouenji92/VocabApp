<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Dashboard - VocabApp</title>
  <link rel="stylesheet" href="{{ url_for('static', path='/base.css') }}" />
  <style>
    :root { --header-offset: 84px; }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f0f2f5;
      min-height: 100vh;
    }

    /* Header styles centralized in /static/base.css */

    main {
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 20px 40px;
    }

    .page-header {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .page-header h1 {
      font-size: 2em;
      color: #050505;
      margin-bottom: 8px;
    }

    .page-header p {
      color: #65676b;
      font-size: 1em;
    }

    .layout-grid { 
      display: grid; 
      grid-template-columns: 1fr 340px; 
      gap: 20px; 
      align-items: start; 
    }

    @media (max-width: 1000px){ 
      .layout-grid { 
        grid-template-columns: 1fr; 
      } 
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      transition: all 0.3s;
    }

    .quick-actions { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); 
      gap: 16px; 
      margin-bottom: 20px; 
    }

    .quick-action { 
      display: flex; 
      gap: 16px; 
      align-items: center; 
      text-decoration: none;
      padding: 20px;
    }

    .quick-action:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }

    .quick-action-icon { 
      font-size: 2.5rem; 
    }

    .quick-action h3 { 
      margin: 0 0 4px 0; 
      font-size: 1.1rem;
      color: #050505;
    }

    .quick-action p { 
      margin: 0; 
      font-size: 0.9rem;
      color: #65676b;
    }

    .stats-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
      gap: 16px;
      margin-bottom: 20px;
    }

    .stat-card { 
      position: relative; 
      overflow: hidden;
      text-align: center;
    }

    .stat-icon { 
      font-size: 2rem;
      margin-bottom: 8px;
    }

    .stat-value { 
      font-size: 2.5rem; 
      font-weight: 800; 
      color: #050505;
      margin: 8px 0;
    }

    .stat-label { 
      font-size: 0.85rem; 
      letter-spacing: 0.5px; 
      text-transform: uppercase; 
      font-weight: 600; 
      color: #65676b;
    }

    .section-title {
      font-size: 1.3em;
      font-weight: 700;
      color: #050505;
      margin-bottom: 16px;
    }

    .recent-sets-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); 
      gap: 16px; 
    }

    .set-item h3 { 
      margin: 0 0 8px 0; 
      font-size: 1.1rem;
      color: #050505;
    }

    .set-item p {
      color: #65676b;
      margin: 8px 0;
      font-size: 0.9em;
    }

    /* Căn bố cục thẻ bộ từ gần đây: tiêu đề/miêu tả linh hoạt, nút luôn bám đáy */
    .recent-sets-grid .set-item {
      display: flex;
      flex-direction: column;
      min-height: 180px;
    }

    /* Giới hạn 2 dòng để chiều cao đồng đều nhưng vẫn tùy nội dung */
    .recent-sets-grid .set-item p.muted {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      line-clamp: 2; /* standard */
      overflow: hidden;
      min-height: 2.6em; /* ~2 dòng 0.9em với line-height mặc định */
    }

    .recent-sets-grid .set-item h3 {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .actions { 
      display: flex; 
      gap: 8px; 
      flex-wrap: wrap; 
      margin-top: 12px; 
    }

    /* Đẩy khu vực nút xuống đáy thẻ để các thẻ thẳng hàng bất kể mô tả dài/ngắn */
    .recent-sets-grid .set-item .actions {
      margin-top: auto;
    }

    .btn-ghost {
      padding: 8px 16px;
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s;
      font-size: 0.9em;
    }

    .btn-ghost:hover {
      background: #667eea;
      color: white;
    }

    .btn-primary {
      padding: 8px 16px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s;
      font-size: 0.9em;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #65676b;
    }

    .empty-state a { 
      color: #667eea;
      font-weight: 600;
      text-decoration: none;
    }

    /* Cố định toàn bộ cột aside dưới header, tránh bị header che và tránh hai thẻ dính chồng nhau */
    aside { 
      position: sticky; 
      top: var(--header-offset);
      align-self: start;
      height: fit-content;
      z-index: 50; /* dưới header (z=100), đủ cao để không bị nội dung bên dưới che */
    }
    /* Card trong aside trở về vị trí bình thường để xếp chồng tự nhiên */
    aside .card { 
      position: static; 
    }

    @media (max-width: 768px) {
      .nav-icons {
        gap: 8px;
      }

      main {
        padding: 0 16px 40px;
      }

      .page-header h1 {
        font-size: 1.5em;
      }

      .quick-actions {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  {% set active_page = 'dashboard' %}
  {% include 'header.html' %}

  <div class="back-button-container">
    <button onclick="history.back()" class="back-button">
      <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13 8L5 16L13 24" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 16H27C35 16 41 22 41 30C41 38 35 44 27 44H21" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Quay lại
    </button>
  </div>

  <main>
    <div class="page-header">
  <h1><span class="iconify icon-chart icon-24 icon-gradient-accent" style="margin-right:8px;"></span>Thống kê</h1>
      <p>Tổng quan học tập hôm nay</p>
    </div>
    <div class="layout-grid">
      <section>
        <div class="quick-actions">
          <a href="/" class="card quick-action" aria-label="Tải lên bộ từ mới">
            <div class="quick-action-icon"><span class="iconify icon-upload icon-40 icon-gradient-accent"></span></div>
            <div>
              <h3>Tải lên File</h3>
              <p class="muted">Thêm bộ từ mới</p>
            </div>
          </a>
          <a href="/sets" class="card quick-action" aria-label="Xem tất cả bộ từ">
            <div class="quick-action-icon"><span class="iconify icon-book icon-40 icon-gradient-accent"></span></div>
            <div>
              <h3>Quản lý Bộ Từ</h3>
              <p class="muted">Xem & chỉnh sửa</p>
            </div>
          </a>
          {% if recent_sets %}
          <a href="/study/{{ recent_sets[0].id }}?mode=select" class="card quick-action" aria-label="Học ngay">
            <div class="quick-action-icon"><span class="iconify icon-target icon-40 icon-gradient-accent"></span></div>
            <div>
              <h3>Học Nhanh</h3>
              <p class="muted">Tiếp tục bộ gần nhất</p>
            </div>
          </a>
          {% else %}
          <a href="#" class="card quick-action" aria-label="Học ngay" style="pointer-events:none;opacity:.4;">
            <div class="quick-action-icon"><span class="iconify icon-target icon-40 icon-gradient-accent" style="opacity:.35;"></span></div>
            <div>
              <h3>Học Nhanh</h3>
              <p class="muted">Tiếp tục bộ gần nhất</p>
            </div>
          </a>
          {% endif %}
        </div>
        <div class="stats-grid" style="margin-bottom:2rem;">
          <div class="card stat-card" aria-label="Tổng số bộ từ">
            <div class="stat-icon"><span class="iconify icon-collection icon-32 icon-gradient-accent"></span></div>
            <div class="stat-value">{{ stats.total_sets }}</div>
            <div class="stat-label">Bộ từ</div>
          </div>
          <div class="card stat-card" aria-label="Tổng số từ vựng">
            <div class="stat-icon"><span class="iconify icon-note icon-32 icon-gradient-accent"></span></div>
            <div class="stat-value">{{ stats.total_words }}</div>
            <div class="stat-label">Từ vựng</div>
          </div>
          <div class="card stat-card" aria-label="Từ đã học">
            <div class="stat-icon"><span class="iconify icon-target icon-32 icon-gradient-accent"></span></div>
            <div class="stat-value">{{ stats.learned_words }}</div>
            <div class="stat-label">Đã học</div>
          </div>
          <div class="card stat-card" aria-label="Từ cần ôn hôm nay">
            <div class="stat-icon"><span class="iconify icon-clock icon-32 icon-gradient-accent"></span></div>
            <div class="stat-value">{{ stats.due_today }}</div>
            <div class="stat-label">Cần ôn</div>
          </div>
          <div class="card stat-card" aria-label="Độ chính xác">
            <div class="stat-icon"><span class="iconify icon-school icon-32 icon-gradient-accent"></span></div>
            <div class="stat-value">{{ stats.accuracy }}%</div>
            <div class="stat-label">Chính xác</div>
          </div>
          <div class="card stat-card" aria-label="Chuỗi ngày học">
            <div class="stat-icon"><span class="iconify icon-fire icon-32 icon-gradient-accent"></span></div>
            <div class="stat-value">{{ stats.streak }}</div>
            <div class="stat-label">Streak</div>
          </div>
        </div>
        <section class="card" aria-labelledby="recent-heading">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap;">
            <h2 id="recent-heading" style="margin:0;"><span class="iconify icon-book icon-22 icon-gradient-accent" style="margin-right:6px;"></span>Bộ từ gần đây</h2>
            <a href="/sets" class="btn-ghost" style="white-space:nowrap;">Xem tất cả →</a>
          </div>
          {% if recent_sets %}
          <div class="recent-sets-grid" style="margin-top:1rem;">
            {% for s in recent_sets %}
            <div class="card set-item" style="padding:1rem;">
              <h3>{{ s.name }}</h3>
              <p class="muted" style="margin:.25rem 0 .5rem;">{{ s.description or 'Không có mô tả' }}</p>
              <div class="muted" style="font-size:.75rem;letter-spacing:.5px;">{{ s.language_from }} → {{ s.language_to }}</div>
              <div class="actions">
                <a href="/sets/{{ s.id }}" class="btn-ghost"><span class="iconify icon-collection icon-16 icon-gradient-accent" style="margin-right:4px;"></span>Chi tiết</a>
                <a href="/study/{{ s.id }}?mode=select" class="btn" style="flex:1;min-width:120px;"><span class="iconify icon-target icon-16 icon-gradient-accent" style="margin-right:4px;"></span>Học</a>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state" style="text-align:center;padding:1.25rem .75rem;">
            <div style="font-size:2rem;"><span class="iconify icon-collection icon-36 icon-gradient-accent"></span></div>
            <p style="margin:.5rem 0 0;">Chưa có bộ từ nào. <a href="/" style="font-weight:600;">Tải lên file</a> để bắt đầu!</p>
          </div>
          {% endif %}
        </section>
      </section>
      <aside>
        <div class="card" aria-label="Gợi ý tiếp theo" style="margin-bottom:1rem;">
          <h2 style="margin-top:0;"><span class="iconify icon-rocket icon-22 icon-gradient-accent" style="margin-right:6px;"></span>Tiến bộ</h2>
          <p class="muted" style="font-size:.9rem;">Tập trung ôn các từ đến hạn để duy trì streak và cải thiện độ chính xác.</p>
          <ul style="list-style:none;padding:0;margin:0;display:grid;gap:.5rem;font-size:.85rem;">
            <li><span class="iconify icon-clock icon-14 icon-gradient-accent" style="margin-right:4px;"></span>Đến hạn hôm nay: <strong>{{ stats.due_today }}</strong></li>
            <li><span class="iconify icon-target icon-14 icon-gradient-accent" style="margin-right:4px;"></span>Đã học: <strong>{{ stats.learned_words }}</strong> / {{ stats.total_words }}</li>
            <li><span class="iconify icon-fire icon-14 icon-gradient-accent" style="margin-right:4px;"></span>Streak: <strong>{{ stats.streak }}</strong> ngày</li>
            <li><span class="iconify icon-school icon-14 icon-gradient-accent" style="margin-right:4px;"></span>Chính xác: <strong>{{ stats.accuracy }}%</strong></li>
          </ul>
          <div style="margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap;">
            {% if recent_sets %}
            <a href="/study/{{ recent_sets[0].id }}?mode=select" class="btn"><span class="iconify icon-cards icon-16 icon-gradient-accent" style="margin-right:6px;"></span>Ôn ngay</a>
            {% else %}
            <a href="#" class="btn" style="pointer-events:none;opacity:.4;"><span class="iconify icon-cards icon-16 icon-gradient-accent" style="margin-right:6px;opacity:.5;"></span>Ôn ngay</a>
            {% endif %}
            <a href="/" class="btn-ghost"><span class="iconify icon-upload icon-16 icon-gradient-accent" style="margin-right:6px;"></span>Thêm bộ mới</a>
          </div>
        </div>
        <div class="card" aria-label="Mẹo" style="font-size:.85rem;">
          <h2 style="margin-top:0;"><span class="iconify icon-lightbulb icon-20 icon-gradient-accent" style="margin-right:6px;"></span>Mẹo</h2>
          <ul style="padding-left:1rem;margin:.25rem 0;">
            <li>Ôn từ đúng lịch để tối ưu hoá SM-2.</li>
            <li>Dùng chế độ Trắc nghiệm để kiểm tra nhanh.</li>
            <li>Thêm ví dụ giúp ghi nhớ ngữ cảnh.</li>
          </ul>
        </div>
      </aside>
    </div>
  </main>

  <!-- Enhanced Features -->
  <script src="{{ url_for('static', path='/enhanced.js') }}"></script>
  <script>
    // Initialize enhanced features
    const themeManager = new ThemeManager();
    window.toast = new ToastNotification();
  </script>
</body>
</html>

