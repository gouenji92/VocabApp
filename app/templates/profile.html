<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tài khoản - VocabApp</title>
  <link rel="stylesheet" href="/static/base.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background: #f0f2f5; 
    }
    /* Header styles centralized in /static/base.css */

    main { 
      max-width: 1000px; 
      margin: 20px auto; 
      padding: 0 20px 40px; 
    }
    .grid { 
      display:grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 20px; 
    }
    @media (max-width: 900px) { 
      .grid { 
        grid-template-columns: 1fr; 
      } 
    }
    .card { 
      background: white; 
      border-radius: 12px; 
      padding: 20px; 
      box-shadow: 0 1px 2px rgba(0,0,0,0.1); 
    }
    .section-title { font-weight: 700; margin: 0 0 12px 0; font-size: 1.2rem; }
    .field { display:flex; flex-direction:column; gap:6px; margin-bottom:12px; }
    .field label { color:#555; font-size:.9rem; }
    .field input[type="text"], .field input[type="email"], .field input[type="password"] { padding:10px 12px; border:1px solid #e4e6eb; border-radius:8px; background:#f7f8fa; }
    .btn { padding:10px 16px; border:none; border-radius:8px; background: linear-gradient(135deg, #667eea, #764ba2); color:white; font-weight:700; cursor:pointer; }
    .btn-ghost { padding:10px 16px; border:2px solid #667eea; color:#667eea; border-radius:8px; background:white; font-weight:700; cursor:pointer; text-decoration:none; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .message { padding:10px 12px; border-radius:8px; margin-bottom:12px; font-size:.95rem; }
    .success { background:#ecfdf5; border:1px solid #10b981; color:#065f46; }
    .error { background:#fef2f2; border:1px solid #ef4444; color:#991b1b; }
    .avatar-preview { display:flex; align-items:center; gap:12px; }
    .avatar-preview img, .avatar-preview .fallback { width:64px; height:64px; border-radius:50%; object-fit:cover; display:block; background: linear-gradient(135deg, #667eea, #764ba2); color:white; font-weight:700; align-items:center; justify-content:center; }
  </style>
</head>
<body>
  {% set active_page = 'profile' %}
  {% include 'header.html' %}

  <div class="back-button-container">
    <button onclick="history.back()" class="back-button">
      <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13 8L5 16L13 24" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 16H27C35 16 41 22 41 30C41 38 35 44 27 44H21" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Quay lại
    </button>
  </div>

  <main>
    <div class="grid">
      <section class="card">
        <h2 class="section-title">
          <span class="iconify icon-user icon-24 icon-gradient-accent" style="margin-right:8px; vertical-align: middle;"></span>
          Hồ sơ
        </h2>
        {% if message %}<div class="message success">✅ {{ message }}</div>{% endif %}
        {% if error %}<div class="message error">❌ {{ error }}</div>{% endif %}
        <form method="post" action="/profile/update" enctype="multipart/form-data">
          <div class="field">
            <label>Tên hiển thị</label>
            <input type="text" name="display_name" value="{{ (user.display_name or username) if user else username }}" />
          </div>
          <div class="field">
            <label>Email</label>
            <input type="email" name="email" value="{{ user.email if user else '' }}" />
          </div>
          <div class="field">
            <label>Ảnh đại diện (JPG/PNG, &lt; 2MB)</label>
            <div class="avatar-preview" style="flex-wrap:wrap; gap:16px;">
              {% if user and user.avatar %}
                <img src="{{ user.avatar }}" alt="avatar">
              {% else %}
                <div class="fallback" style="display:flex;">{{ username[0].upper() }}</div>
              {% endif %}
              <!-- From Uiverse.io by Yaya12085 -->
              <label class="custum-file-upload" for="avatar-input" style="margin-left:0;">
                <div class="icon">
                  <span class="iconify icon-camera icon-48 icon-gradient-accent"></span>
                </div>
                <div class="text"><span>Chọn ảnh đại diện</span></div>
                <input id="avatar-input" type="file" name="avatar" accept="image/png, image/jpeg" />
              </label>
            </div>
          </div>
          <div class="row">
            <button class="btn" type="submit">Lưu thay đổi</button>
            <a href="/" class="btn-ghost">Hủy</a>
          </div>
        </form>
      </section>

      <section class="card">
        <h2 class="section-title">
          <span class="iconify icon-lock-line icon-24 icon-gradient-accent" style="margin-right:8px; vertical-align: middle;"></span>
          Đổi mật khẩu
        </h2>
        <form method="post" action="/profile/change-password">
          <div class="field">
            <label>Mật khẩu hiện tại</label>
            <input type="password" name="current_password" required />
          </div>
          <div class="field">
            <label>Mật khẩu mới</label>
            <input type="password" name="new_password" required />
          </div>
          <div class="field">
            <label>Nhập lại mật khẩu mới</label>
            <input type="password" name="new_password2" required />
          </div>
          <div class="row">
            <button class="btn" type="submit">Cập nhật mật khẩu</button>
          </div>
        </form>
      </section>
    </div>
  </main>
    <script src="{{ url_for('static', path='/enhanced.js') }}"></script>
    <script>
      // Initialize enhanced features (theme, toasts)
      const themeManager = new ThemeManager();
      window.toast = new ToastNotification();
    </script>
    <script src="/static/file_upload.js"></script>
  </body>
</html>

