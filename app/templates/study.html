<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Học từ vựng - {{ set_name }}</title>
  <link rel="stylesheet" href="{{ url_for('static', path='/base.css') }}" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f0f2f5;
      min-height: 100vh;
    }
    /* Header styles are unified in /static/base.css */
    .study-card { 
      min-height: 280px; 
      display:flex; 
      flex-direction:column; 
      justify-content:center; 
      align-items:center; 
      cursor:pointer;
      transition: all 0.3s ease;
      background: var(--surface);
      border-radius: var(--radius-md);
      padding: 40px;
      box-shadow: var(--shadow-md);
    }
    .study-card.flipped { 
      background: var(--primary-gradient);
      color:#fff;
      box-shadow: var(--shadow-colored);
    }
    .term { 
      font-size:2.2rem; 
      font-weight:800; 
      color: var(--text);
      margin-bottom:0.5rem;
    }
    .study-card.flipped .term {
      color: #fff;
    }
    .definition { 
      font-size:1.5rem; 
      margin-top:1rem; 
      color:#fff;
      line-height: 1.5;
    }
    .pos { 
      font-size:1rem; 
      color: var(--text-secondary); 
      margin-top:.5rem;
    }
    .study-card.flipped .pos {
      color: rgba(255,255,255,0.9);
    }
    .rating-btn {
      padding: 12px 20px;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
      white-space: nowrap;
      min-width: 140px;
    }
    .rating-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .rating-btn.danger {
      background: var(--danger);
    }
    .rating-btn.warning {
      background: var(--warning);
    }
    .rating-btn.success {
      background: var(--primary-gradient);
    }
    @media (max-width: 768px) {
      .term { font-size: 1.8rem; }
      .definition { font-size: 1.2rem; }
      .rating-btn {
        min-width: 110px;
        padding: 10px 16px;
        font-size: 0.85rem;
      }
    }
  </style>
</head>
<body>
  {% set active_page = 'sets' %}
  {% include 'header.html' %}

  <div class="back-button-container">
    <button onclick="history.back()" class="back-button">
      <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13 8L5 16L13 24" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 16H27C35 16 41 22 41 30C41 38 35 44 27 44H21" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Quay lại
    </button>
  </div>
  <main style="max-width: 720px; margin: 20px auto; padding: 0 20px; text-align:center;">
    <div style="background:white;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 1px 2px rgba(0,0,0,0.1);">
  <h1 style="margin:0 0 .25rem 0;color:#050505;"><span class="iconify icon-cards icon-26 icon-gradient-accent" style="margin-right:8px;"></span>Học: {{ set_name }}</h1>
      <div style="color:#65676b;" id="info">Nhấn vào thẻ để lật xem nghĩa</div>
    </div>
    <div class="study-card" id="flashcard" onclick="flipCard()">
      <div id="front"></div>
    </div>
    <div style="background:white;border-radius:12px;padding:30px;box-shadow:0 1px 2px rgba(0,0,0,0.1);margin-top:20px;display:none;" id="rating">
      <p style="margin:0 0 1rem 0;color:#050505;font-weight:600;font-size:1.05rem;">Bạn nhớ từ này thế nào?</p>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:0.75rem;max-width:700px;margin:0 auto;">
  <button class="rating-btn danger" onclick="rate(0)"><span class="iconify icon-delete icon-16" style="margin-right:6px;"></span>Quên (0)</button>
  <button class="rating-btn danger" onclick="rate(1)"><span class="iconify icon-warning icon-16" style="margin-right:6px;"></span>Sai nhiều (1)</button>
  <button class="rating-btn danger" onclick="rate(2)"><span class="iconify icon-warning icon-16" style="margin-right:6px;"></span>Sai ít (2)</button>
  <button class="rating-btn warning" onclick="rate(3)"><span class="iconify icon-target icon-16" style="margin-right:6px;"></span>Khó (3)</button>
  <button class="rating-btn success" onclick="rate(4)"><span class="iconify icon-heart icon-16" style="margin-right:6px;"></span>Tốt (4)</button>
  <button class="rating-btn success" onclick="rate(5)"><span class="iconify icon-star icon-16" style="margin-right:6px;"></span>Dễ (5)</button>
      </div>
    </div>
  </main>
  <script>
const setId = "{{ set_id }}";
let currentTerm = null;
let flipped = false;

async function loadNext() {
  const resp = await fetch('/api/next', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ set_id: setId })
  });
  const data = await resp.json();
  if(!data.term){ 
    document.getElementById('front').innerHTML = '<span class="iconify icon-rocket icon-20 icon-gradient-accent" style="margin-right:6px;"></span>Đã hết từ!';
    document.getElementById('rating').style.display = 'none';
    return;
  }
  currentTerm = data.term;
  flipped = false;
  document.getElementById('flashcard').classList.remove('flipped');
  document.getElementById('front').innerHTML = `<div class="term">${currentTerm.term}</div><div class="pos">${currentTerm.pos || ''}</div>`;
  document.getElementById('rating').style.display = 'none';
  document.getElementById('info').innerText = 'Nhấn vào thẻ để lật xem nghĩa';
}

function flipCard() {
  if(flipped) return;
  flipped = true;
  document.getElementById('flashcard').classList.add('flipped');
  document.getElementById('front').innerHTML = `<div class="definition">${currentTerm.definition}</div>`;
  document.getElementById('rating').style.display = 'block';
  document.getElementById('info').innerText = '';
}

async function rate(quality) {
  const resp = await fetch('/api/answer', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ term_id: currentTerm.id, rating: quality })
  });
  await resp.json();
  loadNext();
}

loadNext();
  </script>
</body>
</html>



