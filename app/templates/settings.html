<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√†i ƒë·∫∑t - VocabApp</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/base.css') }}">
    <style>
        .settings-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 24px;
        }

        .settings-header {
            margin-bottom: 32px;
        }

        .settings-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .settings-header p {
            color: var(--text-secondary);
            font-size: 15px;
        }

        .settings-section {
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .settings-section h2 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-light);
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item-content {
            flex: 1;
        }

        .settings-item-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .settings-item-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .settings-item-control {
            margin-left: 20px;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: 0.3s;
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--instagram-purple), var(--instagram-pink));
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .toggle-slider:hover {
            opacity: 0.9;
        }

        /* Theme Preview */
        .theme-preview {
            display: flex;
            gap: 16px;
            margin-top: 16px;
        }

        .theme-card {
            flex: 1;
            padding: 20px;
            border-radius: var(--radius-md);
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .theme-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .theme-card.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(225, 48, 108, 0.1);
        }

        .theme-card-preview {
            width: 100%;
            height: 80px;
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .theme-card-light .theme-card-preview {
            background: linear-gradient(135deg, #ffffff, #fafafa);
            border: 1px solid #dbdbdb;
        }

        .theme-card-dark .theme-card-preview {
            background: linear-gradient(135deg, #000000, #1a1a1a);
            border: 1px solid #262626;
        }

        .theme-card-auto .theme-card-preview {
            background: linear-gradient(135deg, #ffffff 0%, #ffffff 50%, #000000 50%, #000000 100%);
        }

        .theme-card-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .theme-card-description {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Select Dropdown */
        .settings-select {
            padding: 10px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            color: var(--text);
            font-size: 14px;
            cursor: pointer;
            min-width: 180px;
            transition: border-color 0.2s ease;
        }

        .settings-select:hover {
            border-color: var(--primary);
        }

        .settings-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(225, 48, 108, 0.1);
        }

        /* Button */
        .settings-btn {
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .settings-btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .settings-btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .settings-btn-secondary {
            background: var(--surface-elevated);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .settings-btn-secondary:hover {
            background: var(--sidebar-hover);
        }

        .settings-btn-danger {
            background: var(--danger);
            color: white;
        }

        .settings-btn-danger:hover {
            opacity: 0.9;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .settings-container {
                padding: 16px;
            }

            .settings-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .settings-item-control {
                margin-left: 0;
                margin-top: 12px;
                width: 100%;
            }

            .theme-preview {
                flex-direction: column;
            }

            .settings-select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    {% set active_page = 'settings' %}
    {% include 'header.html' %}

    <div class="settings-container">
        <!-- Header -->
        <div class="settings-header">
            <h1>
                <span class="iconify icon-settings icon-32 icon-gradient-accent" style="margin-right: 12px; vertical-align: middle;"></span>
                C√†i ƒë·∫∑t
            </h1>
            <p>Qu·∫£n l√Ω t√†i kho·∫£n v√† t√πy ch·ªânh tr·∫£i nghi·ªám c·ªßa b·∫°n</p>
        </div>

        <!-- Appearance Settings -->
        <div class="settings-section">
            <h2>üé® Giao di·ªán</h2>
            
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">Ch·∫ø ƒë·ªô t·ªëi (Dark Mode)</div>
                    <div class="settings-item-description">
                        B·∫≠t ch·∫ø ƒë·ªô t·ªëi ƒë·ªÉ b·∫£o v·ªá m·∫Øt khi s·ª≠ d·ª•ng v√†o ban ƒë√™m ho·∫∑c trong m√¥i tr∆∞·ªùng √°nh s√°ng y·∫øu
                    </div>
                </div>
                <div class="settings-item-control">
                    <label class="toggle-switch">
                        <input type="checkbox" id="darkModeToggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">Ch·ªß ƒë·ªÅ giao di·ªán</div>
                    <div class="settings-item-description">
                        Ch·ªçn ch·ªß ƒë·ªÅ hi·ªÉn th·ªã cho ·ª©ng d·ª•ng
                    </div>
                    <div class="theme-preview">
                        <div class="theme-card theme-card-light" data-theme="light">
                            <div class="theme-card-preview">‚òÄÔ∏è</div>
                            <div class="theme-card-name">S√°ng</div>
                            <div class="theme-card-description">Giao di·ªán s√°ng</div>
                        </div>
                        <div class="theme-card theme-card-dark" data-theme="dark">
                            <div class="theme-card-preview">üåô</div>
                            <div class="theme-card-name">T·ªëi</div>
                            <div class="theme-card-description">Giao di·ªán t·ªëi</div>
                        </div>
                        <div class="theme-card theme-card-auto" data-theme="auto">
                            <div class="theme-card-preview">üîÑ</div>
                            <div class="theme-card-name">T·ª± ƒë·ªông</div>
                            <div class="theme-card-description">Theo h·ªá th·ªëng</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Settings -->
        <div class="settings-section">
            <h2>üë§ T√†i kho·∫£n</h2>
            
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">T√™n ng∆∞·ªùi d√πng</div>
                    <div class="settings-item-description">{{ username }}</div>
                </div>
            </div>

            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">Email</div>
                    <div class="settings-item-description">{{ user.email if user else 'Ch∆∞a c·∫≠p nh·∫≠t' }}</div>
                </div>
                <div class="settings-item-control">
                    <button class="settings-btn settings-btn-secondary" onclick="window.location.href='/profile'">
                        Ch·ªânh s·ª≠a
                    </button>
                </div>
            </div>

            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">Ng√†y tham gia</div>
                    <div class="settings-item-description" id="joinedDate">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Learning Settings -->
        <div class="settings-section">
            <h2>üìö H·ªçc t·∫≠p</h2>
            
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">Ng√¥n ng·ªØ giao di·ªán</div>
                    <div class="settings-item-description">Ch·ªçn ng√¥n ng·ªØ hi·ªÉn th·ªã cho ·ª©ng d·ª•ng</div>
                </div>
                <div class="settings-item-control">
                    <select class="settings-select" id="languageSelect">
                        <option value="vi" selected>Ti·∫øng Vi·ªát</option>
                        <option value="en">English</option>
                        <option value="ja">Êó•Êú¨Ë™û</option>
                    </select>
                </div>
            </div>

            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">T·ª± ƒë·ªông ph√°t √¢m thanh</div>
                    <div class="settings-item-description">Ph√°t √¢m thanh t·ª± ƒë·ªông khi xem t·ª´ v·ª±ng</div>
                </div>
                <div class="settings-item-control">
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoPlayAudio">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">S·ªë t·ª´ m·ªói b√†i h·ªçc</div>
                    <div class="settings-item-description">S·ªë l∆∞·ª£ng t·ª´ v·ª±ng trong m·ªói phi√™n h·ªçc</div>
                </div>
                <div class="settings-item-control">
                    <select class="settings-select" id="wordsPerSession">
                        <option value="10">10 t·ª´</option>
                        <option value="20" selected>20 t·ª´</option>
                        <option value="30">30 t·ª´</option>
                        <option value="50">50 t·ª´</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Notifications Settings -->
        <div class="settings-section">
            <h2>üîî Th√¥ng b√°o</h2>
            
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">Th√¥ng b√°o h·ªçc t·∫≠p</div>
                    <div class="settings-item-description">Nh·∫≠n nh·∫Øc nh·ªü h·ªçc t·∫≠p h√†ng ng√†y</div>
                </div>
                <div class="settings-item-control">
                    <label class="toggle-switch">
                        <input type="checkbox" id="learningNotifications" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">Th√¥ng b√°o t∆∞∆°ng t√°c</div>
                    <div class="settings-item-description">Nh·∫≠n th√¥ng b√°o khi c√≥ ng∆∞·ªùi like, comment b√†i vi·∫øt</div>
                </div>
                <div class="settings-item-control">
                    <label class="toggle-switch">
                        <input type="checkbox" id="interactionNotifications" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Privacy Settings -->
        <div class="settings-section">
            <h2>üîí Quy·ªÅn ri√™ng t∆∞</h2>
            
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">H·ªì s∆° c√¥ng khai</div>
                    <div class="settings-item-description">Cho ph√©p ng∆∞·ªùi kh√°c xem h·ªì s∆° c·ªßa b·∫°n</div>
                </div>
                <div class="settings-item-control">
                    <label class="toggle-switch">
                        <input type="checkbox" id="publicProfile" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">Hi·ªÉn th·ªã ti·∫øn ƒë·ªô h·ªçc</div>
                    <div class="settings-item-description">Hi·ªÉn th·ªã ti·∫øn ƒë·ªô h·ªçc t·∫≠p tr√™n h·ªì s∆°</div>
                </div>
                <div class="settings-item-control">
                    <label class="toggle-switch">
                        <input type="checkbox" id="showProgress" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Danger Zone -->
        <div class="settings-section" style="border-color: var(--danger);">
            <h2 style="color: var(--danger);">‚ö†Ô∏è V√πng nguy hi·ªÉm</h2>
            
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">X√≥a t·∫•t c·∫£ d·ªØ li·ªáu h·ªçc t·∫≠p</div>
                    <div class="settings-item-description">X√≥a to√†n b·ªô ti·∫øn ƒë·ªô v√† l·ªãch s·ª≠ h·ªçc t·∫≠p c·ªßa b·∫°n</div>
                </div>
                <div class="settings-item-control">
                    <button class="settings-btn settings-btn-secondary" onclick="confirmClearData()">
                        X√≥a d·ªØ li·ªáu
                    </button>
                </div>
            </div>

            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-title">X√≥a t√†i kho·∫£n</div>
                    <div class="settings-item-description">X√≥a vƒ©nh vi·ªÖn t√†i kho·∫£n v√† t·∫•t c·∫£ d·ªØ li·ªáu li√™n quan</div>
                </div>
                <div class="settings-item-control">
                    <button class="settings-btn settings-btn-danger" onclick="confirmDeleteAccount()">
                        X√≥a t√†i kho·∫£n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Features -->
    <script src="{{ url_for('static', path='/enhanced.js') }}"></script>
    <script>
        // Initialize enhanced features
        const themeManager = new ThemeManager();
        window.toast = new ToastNotification();
        const shortcuts = new KeyboardShortcuts();

        // Load current settings
        function loadSettings() {
            // Load theme
            const currentTheme = localStorage.getItem('theme') || 'light';
            const themeMode = localStorage.getItem('themeMode') || 'manual';
            
            // Update dark mode toggle
            document.getElementById('darkModeToggle').checked = currentTheme === 'dark';
            
            // Update theme cards
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.remove('active');
                if (themeMode === 'auto' && card.dataset.theme === 'auto') {
                    card.classList.add('active');
                } else if (themeMode !== 'auto' && card.dataset.theme === currentTheme) {
                    card.classList.add('active');
                }
            });

            // Load other settings from localStorage
            const autoPlayAudio = localStorage.getItem('autoPlayAudio') === 'true';
            document.getElementById('autoPlayAudio').checked = autoPlayAudio;

            const wordsPerSession = localStorage.getItem('wordsPerSession') || '20';
            document.getElementById('wordsPerSession').value = wordsPerSession;

            const languageSelect = localStorage.getItem('language') || 'vi';
            document.getElementById('languageSelect').value = languageSelect;

            // Load joined date
            {% if user and user.joined_date %}
            const joinedDate = new Date('{{ user.joined_date }}');
            document.getElementById('joinedDate').textContent = joinedDate.toLocaleDateString('vi-VN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            {% else %}
            document.getElementById('joinedDate').textContent = 'Kh√¥ng c√≥ th√¥ng tin';
            {% endif %}
        }

        // Dark mode toggle
        document.getElementById('darkModeToggle').addEventListener('change', function() {
            const isDark = this.checked;
            themeManager.theme = isDark ? 'dark' : 'light';
            themeManager.applyTheme(themeManager.theme);
            localStorage.setItem('theme', themeManager.theme);
            localStorage.setItem('themeMode', 'manual');
            
            // Update theme cards
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.remove('active');
                if (card.dataset.theme === themeManager.theme) {
                    card.classList.add('active');
                }
            });
            
            window.toast.show(`ƒê√£ chuy·ªÉn sang ${isDark ? 'ch·∫ø ƒë·ªô t·ªëi' : 'ch·∫ø ƒë·ªô s√°ng'}`, 'success');
        });

        // Theme card selection
        document.querySelectorAll('.theme-card').forEach(card => {
            card.addEventListener('click', function() {
                const theme = this.dataset.theme;
                
                document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                
                if (theme === 'auto') {
                    // Auto mode: follow system preference
                    localStorage.setItem('themeMode', 'auto');
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    themeManager.theme = prefersDark ? 'dark' : 'light';
                    themeManager.applyTheme(themeManager.theme);
                    document.getElementById('darkModeToggle').checked = prefersDark;
                    window.toast.show('Ch·∫ø ƒë·ªô t·ª± ƒë·ªông: Theo c√†i ƒë·∫∑t h·ªá th·ªëng', 'info');
                } else {
                    // Manual mode
                    localStorage.setItem('themeMode', 'manual');
                    themeManager.theme = theme;
                    themeManager.applyTheme(theme);
                    localStorage.setItem('theme', theme);
                    document.getElementById('darkModeToggle').checked = theme === 'dark';
                    window.toast.show(`ƒê√£ chuy·ªÉn sang ch·∫ø ƒë·ªô ${theme === 'dark' ? 't·ªëi' : 's√°ng'}`, 'success');
                }
            });
        });

        // Auto play audio
        document.getElementById('autoPlayAudio').addEventListener('change', function() {
            localStorage.setItem('autoPlayAudio', this.checked);
            window.toast.show(`T·ª± ƒë·ªông ph√°t √¢m thanh: ${this.checked ? 'B·∫≠t' : 'T·∫Øt'}`, 'success');
        });

        // Words per session
        document.getElementById('wordsPerSession').addEventListener('change', function() {
            localStorage.setItem('wordsPerSession', this.value);
            window.toast.show(`S·ªë t·ª´ m·ªói b√†i h·ªçc: ${this.value} t·ª´`, 'success');
        });

        // Language select
        document.getElementById('languageSelect').addEventListener('change', function() {
            localStorage.setItem('language', this.value);
            window.toast.show('Ng√¥n ng·ªØ s·∫Ω ƒë∆∞·ª£c √°p d·ª•ng sau khi t·∫£i l·∫°i trang', 'info');
        });

        // Learning notifications
        document.getElementById('learningNotifications').addEventListener('change', function() {
            localStorage.setItem('learningNotifications', this.checked);
            window.toast.show(`Th√¥ng b√°o h·ªçc t·∫≠p: ${this.checked ? 'B·∫≠t' : 'T·∫Øt'}`, 'success');
        });

        // Interaction notifications
        document.getElementById('interactionNotifications').addEventListener('change', function() {
            localStorage.setItem('interactionNotifications', this.checked);
            window.toast.show(`Th√¥ng b√°o t∆∞∆°ng t√°c: ${this.checked ? 'B·∫≠t' : 'T·∫Øt'}`, 'success');
        });

        // Public profile
        document.getElementById('publicProfile').addEventListener('change', function() {
            localStorage.setItem('publicProfile', this.checked);
            window.toast.show(`H·ªì s∆° c√¥ng khai: ${this.checked ? 'B·∫≠t' : 'T·∫Øt'}`, 'success');
        });

        // Show progress
        document.getElementById('showProgress').addEventListener('change', function() {
            localStorage.setItem('showProgress', this.checked);
            window.toast.show(`Hi·ªÉn th·ªã ti·∫øn ƒë·ªô: ${this.checked ? 'B·∫≠t' : 'T·∫Øt'}`, 'success');
        });

        // Danger zone functions
        function confirmClearData() {
            if (confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu h·ªçc t·∫≠p? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
                window.toast.show('Ch·ª©c nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn', 'info');
            }
        }

        function confirmDeleteAccount() {
            if (confirm('‚ö†Ô∏è C·∫¢NH B√ÅO: B·∫°n s·∫Øp x√≥a vƒ©nh vi·ªÖn t√†i kho·∫£n!\n\nT·∫•t c·∫£ d·ªØ li·ªáu c·ªßa b·∫°n s·∫Ω b·ªã x√≥a v√† kh√¥ng th·ªÉ kh√¥i ph·ª•c.\n\nB·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ti·∫øp t·ª•c?')) {
                if (confirm('Vui l√≤ng x√°c nh·∫≠n l·∫ßn n·ªØa. B·∫°n c√≥ TH·ª∞C S·ª∞ mu·ªën x√≥a t√†i kho·∫£n?')) {
                    window.toast.show('Ch·ª©c nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn', 'info');
                }
            }
        }

        // Listen for system theme changes when in auto mode
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            const themeMode = localStorage.getItem('themeMode');
            if (themeMode === 'auto') {
                themeManager.theme = e.matches ? 'dark' : 'light';
                themeManager.applyTheme(themeManager.theme);
                document.getElementById('darkModeToggle').checked = e.matches;
            }
        });

        // Load settings on page load
        loadSettings();
    </script>
</body>
</html>
