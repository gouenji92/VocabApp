<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Feed - VocabApp</title>
  <link rel="stylesheet" href="{{ url_for('static', path='/base.css') }}">
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Post Header */
    .post-header { padding: 16px; display: flex; gap: 12px; align-items: flex-start; }
    .author-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.1em; flex-shrink: 0; cursor: pointer; transition: transform 0.2s; }
    .author-avatar:hover { transform: scale(1.05); }
    .post-info { flex: 1; }
    .author-name { font-weight: 700; color: #050505; font-size: 0.95em; margin-bottom: 4px; }
    .author-name:hover { text-decoration: underline; }
    .post-time { color: #65676b; font-size: 0.8em; }
    .post-menu { background: none; border: none; color: #65676b; font-size: 1.5em; cursor: pointer; padding: 0 8px; }

    /* Post Content */
    .post-content { padding: 0 16px 12px; }
    .post-title { font-size: 1.3em; font-weight: 700; color: #050505; margin-bottom: 8px; }
    .post-description { color: #333; line-height: 1.5; margin-bottom: 12px; }
    .post-meta { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
    .meta-tag { display: inline-flex; align-items: center; gap: 4px; padding: 4px 12px; background: #f0f2f5; border-radius: 16px; font-size: 0.85em; color: #65676b; }

    /* Terms Preview */
    .terms-preview { background: #f7f8fa; border-radius: 12px; padding: 16px; margin-top: 12px; }
    .terms-preview-title { font-size: 0.9em; font-weight: 600; color: #65676b; margin-bottom: 12px; }
    .term-item { padding: 10px 0; border-bottom: 1px solid #e4e6eb; }
    .term-item:last-child { border-bottom: none; }
    .term-word { font-weight: 700; color: #667eea; margin-bottom: 4px; }
    .term-def { color: #333; font-size: 0.95em; }
    .view-all-terms { text-align: center; margin-top: 12px; }
    .view-all-terms a { color: #667eea; text-decoration: none; font-weight: 600; font-size: 0.9em; }

    /* Post Stats */
  .post-stats { padding: 8px 16px; display: flex; justify-content: space-between; border-top: 1px solid #e4e6eb; color: #65676b; font-size: 0.9em; }
    .stat-item { cursor: pointer; }
    .stat-item:hover { text-decoration: underline; }

    /* Post Actions */
    .post-actions { padding: 8px 16px 12px; display: flex; gap: 8px; border-top: 1px solid #e4e6eb; }
    .action-btn { flex: 1; padding: 10px; background: none; border: none; border-radius: 8px; display: flex; align-items: center; justify-content: center; gap: 6px; cursor: pointer; color: var(--text-secondary); font-weight: 600; font-size: 0.95em; transition: all 0.2s; }
    .action-btn:hover { background: var(--bg); }
    .action-btn .icon-svg { width: 20px; height: 20px; transition: transform 0.2s; }
    .action-btn.liked { color: #e4405f; }
    .action-btn.liked .icon-svg { animation: likeAnimation 0.4s ease; }
    .action-btn.saved { color: #ffcd3c; }
    @keyframes likeAnimation { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }

    /* Comments Section */
    .comments-section { padding: 0; border-top: 1px solid #e4e6eb; max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.4s ease; }
    .comments-section.active { max-height: 800px; overflow-y: auto; padding: 12px 16px; }
    .comment-input { display: flex; gap: 8px; margin-bottom: 16px; }
    .comment-input input { flex: 1; padding: 10px 14px; border: 1px solid var(--border); border-radius: 20px; background: var(--bg); font-size: 0.9em; }
    .comment-input button { padding: 8px 20px; background: var(--primary-gradient); color: white; border: none; border-radius: 20px; font-weight: 600; cursor: pointer; transition: transform 0.2s; }
    .comment-input button:hover { transform: scale(1.05); }
    .comment-item { display: flex; gap: 10px; margin-bottom: 16px; }
    .comment-avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 0.9em; flex-shrink: 0; object-fit: cover; }
    .comment-content { flex: 1; }
    .comment-bubble { background: var(--bg); padding: 10px 14px; border-radius: 18px; display: inline-block; max-width: 100%; }
    .comment-author { font-weight: 700; font-size: 0.85em; margin-bottom: 2px; color: var(--text); }
    .comment-text { font-size: 0.9em; color: var(--text); line-height: 1.4; }
    .comment-actions { display: flex; gap: 12px; align-items: center; margin-top: 6px; margin-left: 12px; }
    .comment-action-btn { background: none; border: none; color: var(--text-secondary); font-size: 0.75em; font-weight: 600; cursor: pointer; padding: 0; transition: color 0.2s; }
    .comment-action-btn:hover { color: var(--text); }
    .comment-action-btn.liked { color: #e4405f; font-weight: 700; }
    .comment-time { font-size: 0.75em; color: var(--text-secondary); }
    .comment-replies { margin-left: 42px; margin-top: 12px; }
    .reply-input { display: flex; gap: 8px; margin-left: 42px; margin-top: 12px; margin-bottom: 12px; }
    .reply-input input { flex: 1; padding: 8px 12px; border: 1px solid var(--border); border-radius: 16px; background: var(--bg); font-size: 0.85em; }
    .reply-input button { padding: 6px 16px; background: var(--accent); color: white; border: none; border-radius: 16px; font-weight: 600; cursor: pointer; font-size: 0.85em; }

    /* Post/Comment Menu Dropdown */
    .post-menu, .comment-menu { position: relative; background: none; border: none; color: #65676b; font-size: 1.5em; cursor: pointer; padding: 4px 8px; border-radius: 50%; transition: background 0.2s; }
    .post-menu:hover, .comment-menu:hover { background: #f0f2f5; }
    .menu-dropdown { display: none; position: absolute; top: 100%; right: 0; background: white; border: 1px solid #e4e6eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; min-width: 150px; }
    .menu-dropdown.active { display: block; }
    .menu-item { display: flex; align-items: center; gap: 10px; padding: 12px 16px; cursor: pointer; transition: background 0.2s; border: none; background: none; width: 100%; text-align: left; font-size: 0.9em; color: #050505; }
    .menu-item:hover { background: #f0f2f5; }
    .menu-item.danger { color: #ed4956; }
    .menu-item.danger:hover { background: #ffebee; }
    .menu-item img { width: 18px; height: 18px; }

    /* Edit Modal */
    .edit-modal-textarea { width: 100%; min-height: 80px; padding: 12px; border: 1px solid #e4e6eb; border-radius: 8px; font-size: 0.95em; resize: vertical; font-family: inherit; }

    .loading { text-align: center; padding: 40px; color: #65676b; }
    .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 12px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Empty State */
    .empty-feed { text-align: center; padding: 60px 20px; background: white; border-radius: 12px; margin-top: 20px; }
    .empty-feed h2 { font-size: 1.5em; color: #333; margin-bottom: 12px; }
    .empty-feed p { color: #65676b; margin-bottom: 20px; }
    .empty-feed .btn { padding: 12px 32px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 25px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-block; }

    /* Create Post Button */
    .create-post-btn { flex: 1; padding: 12px 16px; background: #f0f2f5; border: none; border-radius: 25px; text-align: left; color: #65676b; cursor: pointer; font-size: 0.95em; transition: background 0.2s; }
    .create-post-btn:hover { background: #e4e6eb; }

    /* Create Post Modal */
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 1000; align-items: center; justify-content: center; }
    .modal-overlay.active { display: flex; }
    .modal-box { background: white; border-radius: 12px; width: 90%; max-width: 550px; max-height: 90vh; overflow-y: auto; box-shadow: 0 12px 48px rgba(0,0,0,0.3); }
    .modal-header { padding: 20px; border-bottom: 1px solid #e4e6eb; display: flex; justify-content: space-between; align-items: center; }
    .modal-header h2 { font-size: 1.3em; margin: 0; }
    .modal-close { background: #f0f2f5; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 1.5em; color: #65676b; display: flex; align-items: center; justify-content: center; }
    .modal-close:hover { background: #e4e6eb; }
    .modal-body { padding: 20px; }
    .modal-user-info { display: flex; gap: 12px; align-items: center; margin-bottom: 16px; }
    .modal-textarea { width: 100%; min-height: 120px; border: none; font-size: 1.1em; resize: vertical; font-family: inherit; outline: none; margin-bottom: 16px; }
    .modal-textarea::placeholder { color: #bbb; }
    .attach-set-section { background: #f7f8fa; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
    .attach-set-section label { display: block; font-weight: 600; margin-bottom: 8px; color: #65676b; }
    .attach-set-section select { width: 100%; padding: 10px; border: 1px solid #e4e6eb; border-radius: 8px; font-size: 0.95em; background: white; }
    .modal-footer { padding: 16px 20px; border-top: 1px solid #e4e6eb; }
    .btn-post { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; font-weight: 700; font-size: 1em; cursor: pointer; transition: all 0.3s; }
    .btn-post:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
    .btn-post:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    /* Image Upload Section */
    .image-upload-section { margin-bottom: 16px; }
    .image-preview-container { position: relative; border-radius: 12px; overflow: hidden; margin-bottom: 12px; display: none; }
    .image-preview-container.active { display: block; }
    .image-preview { width: 100%; max-height: 400px; object-fit: cover; border-radius: 12px; }
    .remove-image { position: absolute; top: 12px; right: 12px; background: rgba(0,0,0,0.7); color: white; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 1.2em; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .remove-image:hover { background: rgba(0,0,0,0.9); transform: scale(1.1); }
    .image-drop-zone { border: 2px dashed #d0d5dd; border-radius: 12px; padding: 40px 20px; text-align: center; cursor: pointer; transition: all 0.3s; background: #f9fafb; }
    .image-drop-zone:hover { border-color: #667eea; background: #f0f2ff; }
    .image-drop-zone.drag-over { border-color: #667eea; background: #e8ecff; transform: scale(1.02); }
    .image-drop-zone svg { width: 48px; height: 48px; margin: 0 auto 12px; opacity: 0.5; }
    .image-drop-zone p { margin: 8px 0; color: #65676b; font-size: 0.95em; }
    .image-drop-zone .upload-hint { font-size: 0.85em; color: #98a2b3; }

    /* Share Modal */
    .share-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1001; align-items: center; justify-content: center; }
    .share-modal-overlay.active { display: flex; }
    .share-modal-box { background: white; border-radius: 16px; width: 90%; max-width: 500px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); animation: modalSlideIn 0.3s ease; }
    @keyframes modalSlideIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .share-modal-header { padding: 16px 20px; border-bottom: 1px solid #e4e6eb; display: flex; justify-content: space-between; align-items: center; }
    .share-modal-header h3 { font-size: 1.1em; margin: 0; font-weight: 700; }
    .share-modal-body { padding: 20px; max-height: 60vh; overflow-y: auto; }
    .share-set-preview { background: #f7f8fa; border-radius: 12px; padding: 16px; margin-bottom: 16px; border-left: 4px solid #667eea; }
    .share-set-preview h4 { margin: 0 0 8px 0; color: #667eea; font-size: 1em; }
    .share-set-preview p { margin: 0; color: #65676b; font-size: 0.9em; }
    .share-caption-input { width: 100%; min-height: 100px; padding: 12px; border: 1px solid #e4e6eb; border-radius: 12px; font-size: 0.95em; font-family: inherit; resize: vertical; outline: none; transition: border-color 0.2s; }
    .share-caption-input:focus { border-color: #667eea; }
    .share-caption-label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 0.95em; }
    .share-modal-footer { padding: 16px 20px; border-top: 1px solid #e4e6eb; display: flex; gap: 12px; }
    .btn-share-cancel { flex: 1; padding: 12px; background: #f0f2f5; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
    .btn-share-cancel:hover { background: #e4e6eb; }
    .btn-share-confirm { flex: 1; padding: 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.3s; }
    .btn-share-confirm:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
    .btn-share-confirm:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    /* Text Post Styles */
    .text-post-content { padding: 0 16px 12px; font-size: 1.05em; line-height: 1.6; color: #050505; white-space: pre-wrap; }
    .post-image { width: 100%; max-height: 500px; object-fit: cover; display: block; margin-bottom: 12px; cursor: pointer; }
    .attached-set-preview { margin: 12px 16px; padding: 16px; background: #f7f8fa; border-radius: 12px; border-left: 4px solid #667eea; }
    .attached-set-title { font-weight: 700; color: #667eea; margin-bottom: 8px; font-size: 1.1em; }
    .attached-set-meta { color: #65676b; font-size: 0.9em; }

    @media (max-width: 768px) {
      .search-bar { display: none; }
      .nav-icons { gap: 8px; }
      .container { padding: 0 8px; }
    }
  </style>
</head>
<body>
  {% set active_page = 'feed' %}
  {% include 'header.html' %}

  <div class="container">
    <!-- Create Post Box -->
    <div class="post-card" style="margin-bottom: 16px;">
      <div class="post-header">
        {% if user and user.avatar %}
        <img src="{{ user.avatar }}" class="author-avatar" style="object-fit:cover;" />
        {% else %}
        <div class="author-avatar">{{ username[0].upper() }}</div>
        {% endif %}
        <button class="create-post-btn" onclick="openCreatePostModal()">
          {{ username }} ∆°i, b·∫°n ƒëang nghƒ© g√¨ th·∫ø?
        </button>
      </div>
    </div>

    <div id="feed-container">
      {% if posts %}
        {% for post in posts %}
        <div class="post-card" data-set-id="{{ post.id }}">
          <!-- Post Header -->
          <div class="post-header">
            <a href="/user/{{ post.username or post.owner_username }}" style="text-decoration: none;">
              {% if post.user_avatar %}
              <img src="{{ post.user_avatar }}" class="author-avatar" style="object-fit:cover;" alt="{{ post.user_display_name or post.username }}" />
              {% else %}
              <div class="author-avatar">
                {{ (post.user_display_name or post.username or 'U')[0].upper() }}
              </div>
              {% endif %}
            </a>
            <div class="post-info">
              <a href="/user/{{ post.username or post.owner_username }}" style="text-decoration: none;">
                <div class="author-name">{{ post.user_display_name or post.username or 'Ng∆∞·ªùi d√πng' }}</div>
              </a>
              <div class="post-time">
                {{ format_time(post.created_at) }}
                {% if post.get('edited_at') %}
                  <span style="color: #65676b; font-size: 0.9em;"> ¬∑ ƒê√£ ch·ªânh s·ª≠a</span>
                {% endif %}
              </div>
            </div>
            {% if post.username == username or post.owner_username == username %}
            <div style="position: relative;">
              <button class="post-menu" onclick="togglePostMenu(event, '{{ post.id }}')">
                <span class="iconify icon-more icon-20 icon-gradient-accent" style="display:block;"></span>
              </button>
              <div class="menu-dropdown" id="menu-{{ post.id }}">
                <button class="menu-item" onclick="editPost('{{ post.id }}', event)">
                  <span class="iconify icon-edit icon-18 icon-gradient-accent"></span>
                  <span>Ch·ªânh s·ª≠a</span>
                </button>
                <button class="menu-item danger" onclick="deletePost('{{ post.id }}', event)">
                  <span class="iconify icon-delete icon-18 icon-gradient-accent"></span>
                  <span>X√≥a b√†i vi·∫øt</span>
                </button>
              </div>
            </div>
            {% endif %}
          </div>

          <!-- Post Content -->
          {% if post.post_type == 'text_post' %}
            <!-- Text Post -->
            {% if post.content %}
            <div class="text-post-content">{{ post.content }}</div>
            {% endif %}

            <!-- Post Image -->
            {% if post.image_url %}
            <img src="{{ post.image_url }}" alt="Post image" class="post-image" onclick="window.open(this.src, '_blank')" />
            {% endif %}

            <!-- Attached Set Preview -->
            {% if post.attached_set %}
            <div class="attached-set-preview">
              <div class="attached-set-title">üìö {{ post.attached_set.name }}</div>
              <div class="attached-set-meta">
                {{ post.attached_set.term_count }} t·ª´ ¬∑ 
                {{ post.attached_set.language_from }} ‚Üí {{ post.attached_set.language_to }}
              </div>
              {% if post.attached_set.preview_terms %}
              <div style="margin-top: 12px;">
                {% for term in post.attached_set.preview_terms %}
                <div class="term-item" style="padding: 8px 0; border-bottom: 1px solid #e4e6eb;">
                  <div class="term-word">{{ term.term }}</div>
                  <div class="term-def">{{ term.definition }}</div>
                </div>
                {% endfor %}
              </div>
              {% endif %}
              <div style="margin-top: 12px;">
                <a href="/sets/{{ post.attached_set.id }}" style="color: #667eea; text-decoration: none; font-weight: 600;">
                  Xem chi ti·∫øt ‚Üí
                </a>
              </div>
            </div>
            {% endif %}
          {% else %}
            <!-- Vocab Set Post -->
            <div class="post-content">
              <div class="post-title">{{ post.name }}</div>
              {% if post.description %}
              <div class="post-description">{{ post.description }}</div>
              {% endif %}

              <div class="post-meta">
                <span class="meta-tag"><span class="iconify icon-collection icon-16 icon-gradient-accent" style="opacity:.8;"></span> {{ post.term_count }} t·ª´</span>
                <span class="meta-tag"><span class="iconify icon-globe icon-16 icon-gradient-accent" style="opacity:.8;"></span> {{ post.language_from }} ‚Üí {{ post.language_to }}</span>
              </div>

              <!-- Terms Preview -->
              {% if post.preview_terms %}
              <div class="terms-preview">
                <div class="terms-preview-title"><span class="iconify icon-eye icon-16 icon-gradient-accent" style="margin-right:6px;opacity:.8;"></span>Xem tr∆∞·ªõc t·ª´ v·ª±ng:</div>
                {% for term in post.preview_terms %}
                <div class="term-item">
                  <div class="term-word">{{ term.term }}</div>
                  <div class="term-def">{{ term.definition }}</div>
                </div>
                {% endfor %}
                {% if post.term_count > 3 %}
                <div class="view-all-terms">
                  <a href="/sets/{{ post.id }}">Xem t·∫•t c·∫£ {{ post.term_count }} t·ª´ ‚Üí</a>
                </div>
                {% endif %}
              </div>
              {% endif %}
            </div>
          {% endif %}

          <!-- Post Stats -->
          {% if post.likes_count > 0 or post.comments_count > 0 or post.shares_count > 0 %}
          <div class="post-stats">
            <span class="stat-item">
              {% if post.likes_count > 0 %}<span class="iconify icon-heart icon-16 icon-gradient-accent" style="margin-right:4px;opacity:.85;"></span>{{ post.likes_count }}{% endif %}
            </span>
            <span>
              {% if post.comments_count > 0 %}{{ post.comments_count }} b√¨nh lu·∫≠n{% endif %}
              {% if post.shares_count > 0 %}{% if post.comments_count > 0 %} ¬∑ {% endif %}{{ post.shares_count }} l∆∞·ª£t chia s·∫ª{% endif %}
            </span>
          </div>
          {% endif %}

          <!-- Post Actions -->
          <div class="post-actions">
            <button class="action-btn like-btn {% if post.is_liked %}liked{% endif %}" onclick="toggleLike('{{ post.id }}', this)" data-post-id="{{ post.id }}">
              {% if post.is_liked %}
              <img src="{{ url_for('static', path='/icon_heart_filled.svg') }}" class="icon-svg" alt="Like" />
              {% else %}
              <img src="{{ url_for('static', path='/icon_heart.svg') }}" class="icon-svg" alt="Like" />
              {% endif %}
              <span>Th√≠ch</span>
            </button>
            <button class="action-btn comment-btn" onclick="toggleComments('{{ post.id }}')">
              <img src="{{ url_for('static', path='/icon_comment.svg') }}" class="icon-svg" alt="Comment" />
              <span>B√¨nh lu·∫≠n</span>
            </button>
            <button class="action-btn share-btn" onclick="shareSet('{{ post.id }}', '{{ post.name or post.content[:30] }}')">
              <img src="{{ url_for('static', path='/icon_share.svg') }}" class="icon-svg" alt="Share" />
              <span>Chia s·∫ª</span>
            </button>
            <button class="action-btn bookmark-btn {% if post.is_bookmarked %}saved{% endif %}" onclick="toggleBookmark('{{ post.id }}', this)" data-post-id="{{ post.id }}">
              {% if post.is_bookmarked %}
              <img src="{{ url_for('static', path='/icon_bookmark_filled.svg') }}" class="icon-svg" alt="Bookmark" />
              {% else %}
              <img src="{{ url_for('static', path='/icon_bookmark.svg') }}" class="icon-svg" alt="Bookmark" />
              {% endif %}
              <span>L∆∞u</span>
            </button>
          </div>

          <!-- Comments Section -->
          <div class="comments-section" id="comments-{{ post.id }}">
            <div class="comment-input">
              <input type="text" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." id="comment-input-{{ post.id }}" onkeypress="if(event.key==='Enter') postComment('{{ post.id }}')">
              <button onclick="postComment('{{ post.id }}')">G·ª≠i</button>
            </div>
            <div id="comments-list-{{ post.id }}">
              <!-- Comments will be loaded dynamically -->
            </div>
          </div>
        </div>
        {% endfor %}
      {% else %}
      <div class="empty-feed">
  <h2><span class="iconify icon-star icon-20 icon-gradient-accent" style="margin-right:6px;"></span>Ch∆∞a c√≥ b√†i vi·∫øt n√†o</h2>
        <p>H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n chia s·∫ª b·ªô t·ª´ v·ª±ng c·ªßa b·∫°n!</p>
        <a href="/sets" class="btn">ƒêi ƒë·∫øn B·ªô t·ª´ c·ªßa t√¥i</a>
      </div>
      {% endif %}
    </div>

    <!-- Loading indicator for infinite scroll -->
    <div class="loading" id="loading-indicator" style="display: none;">
      <div class="spinner"></div>
      <p>ƒêang t·∫£i th√™m b√†i vi·∫øt...</p>
    </div>
  </div>

  <!-- Create Post Modal -->
  <div class="modal-overlay" id="createPostModal">
    <div class="modal-box">
      <div class="modal-header">
        <h2>T·∫°o b√†i vi·∫øt</h2>
        <button class="modal-close" onclick="closeCreatePostModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="modal-user-info">
          <div class="author-avatar">{{ username[0].upper() }}</div>
          <div>
            <div style="font-weight: 700;">{{ username }}</div>
            <div style="font-size: 0.85em; color: #65676b;">C√¥ng khai</div>
          </div>
        </div>
        <textarea id="postContent" class="modal-textarea" placeholder="{{ username }} ∆°i, b·∫°n ƒëang nghƒ© g√¨ th·∫ø?" maxlength="5000"></textarea>

        <!-- Image Upload Section -->
        <div class="image-upload-section">
          <div class="image-preview-container" id="imagePreviewContainer">
            <img id="imagePreview" class="image-preview" src="" alt="Preview" />
            <button class="remove-image" onclick="removeImage()" type="button">√ó</button>
          </div>
          <div class="image-drop-zone" id="imageDropZone" onclick="document.getElementById('imageInput').click()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            <p><strong>Th√™m ·∫£nh</strong></p>
            <p class="upload-hint">K√©o th·∫£ ho·∫∑c nh·∫•n ƒë·ªÉ ch·ªçn ·∫£nh</p>
          </div>
          <input type="file" id="imageInput" accept="image/jpeg,image/png,image/jpg,image/gif,image/webp" style="display: none;" onchange="previewImage(event)" />
        </div>

        <div class="attach-set-section">
          <label>üìö ƒê√≠nh k√®m b·ªô t·ª´ (kh√¥ng b·∫Øt bu·ªôc)</label>
          <select id="attachedSetId">
            <option value="">-- Kh√¥ng ƒë√≠nh k√®m --</option>
            {% for set in user_sets %}
            <option value="{{ set.id }}">{{ set.name }} ({{ set.language_from }} ‚Üí {{ set.language_to }})</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-post" onclick="submitPost()" id="btnSubmitPost">ƒêƒÉng</button>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div class="share-modal-overlay" id="shareModal">
    <div class="share-modal-box">
      <div class="share-modal-header">
        <h3>Chia s·∫ª v·ªÅ trang c√° nh√¢n</h3>
        <button class="modal-close" onclick="closeShareModal()">√ó</button>
      </div>
      <div class="share-modal-body">
        <div class="share-set-preview" id="shareSetPreview">
          <!-- Set info will be inserted here -->
        </div>
        <label class="share-caption-label">üí¨ Vi·∫øt g√¨ ƒë√≥ v·ªÅ b·ªô t·ª´ n√†y...</label>
        <textarea id="shareCaption" class="share-caption-input" placeholder="Chia s·∫ª suy nghƒ© c·ªßa b·∫°n v·ªÅ b·ªô t·ª´ n√†y..." maxlength="500"></textarea>
      </div>
      <div class="share-modal-footer">
        <button class="btn-share-cancel" onclick="closeShareModal()">H·ªßy</button>
        <button class="btn-share-confirm" onclick="confirmShare()" id="btnConfirmShare">Chia s·∫ª</button>
      </div>
    </div>
  </div>

  <!-- Edit Post Modal -->
  <div class="modal-overlay" id="editPostModal">
    <div class="modal-box">
      <div class="modal-header">
        <h2>Ch·ªânh s·ª≠a b√†i vi·∫øt</h2>
        <button class="modal-close" onclick="closeEditPostModal()">√ó</button>
      </div>
      <div class="modal-body">
        <textarea id="editPostContent" class="edit-modal-textarea" placeholder="B·∫°n ƒëang nghƒ© g√¨?"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn-post" onclick="saveEditPost()" id="btnSaveEditPost">L∆∞u thay ƒë·ªïi</button>
      </div>
    </div>
  </div>

  <!-- Edit Comment Modal -->
  <div class="modal-overlay" id="editCommentModal">
    <div class="modal-box">
      <div class="modal-header">
        <h2>Ch·ªânh s·ª≠a b√¨nh lu·∫≠n</h2>
        <button class="modal-close" onclick="closeEditCommentModal()">√ó</button>
      </div>
      <div class="modal-body">
        <textarea id="editCommentContent" class="edit-modal-textarea" placeholder="N·ªôi dung b√¨nh lu·∫≠n..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn-post" onclick="saveEditComment()" id="btnSaveEditComment">L∆∞u thay ƒë·ªïi</button>
      </div>
    </div>
  </div>

  <!-- Edit Reply Modal -->
  <div class="modal-overlay" id="editReplyModal">
    <div class="modal-box">
      <div class="modal-header">
        <h2>Ch·ªânh s·ª≠a tr·∫£ l·ªùi</h2>
        <button class="modal-close" onclick="closeEditReplyModal()">√ó</button>
      </div>
      <div class="modal-body">
        <textarea id="editReplyContent" class="edit-modal-textarea" placeholder="N·ªôi dung tr·∫£ l·ªùi..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn-post" onclick="saveEditReply()" id="btnSaveEditReply">L∆∞u thay ƒë·ªïi</button>
      </div>
    </div>
  </div>

  <!-- Feed Interactions Script -->
  <script src="{{ url_for('static', path='/feed.js') }}"></script>

  <!-- Enhanced Features -->
  <script src="{{ url_for('static', path='/enhanced.js') }}"></script>
  <script>
    // Initialize enhanced features
    const themeManager = new ThemeManager();
    window.toast = new ToastNotification();
    const shortcuts = new KeyboardShortcuts();
    
    // Set current username for edit/delete checks
    window.currentUsername = '{{ username }}';
  </script>
</body>
</html>
