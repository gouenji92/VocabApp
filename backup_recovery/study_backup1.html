<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Chi tiáº¿t bá»™ tá»«</title>
  <link rel="stylesheet" href="/static/base.css">
  <style>
    .container { max-width: 1000px; margin: 2rem auto; padding: 0 2rem; }
    .description { color: var(--muted); }
    .meta { color: var(--muted); font-size: 0.95rem; }
    .btn-small { padding: 0.4rem 0.8rem; font-size: 0.9rem; }
    table { width:100%; border-collapse:collapse; margin-top:1rem; }
    th, td { border:1px solid var(--border); padding:.8rem; text-align:left; }
    th { background:var(--bg); font-weight:600; }
    .add-term-form { background: var(--bg); border: 2px dashed #cbd5e1; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; }
  </style>
</head>
<body>
  <header>
    <div class="nav-container" style="display:flex;justify-content:space-between;align-items:center;gap:1rem;">
      <a href="/" class="nav-logo" style="color:#fff;text-decoration:none;font-weight:700;">ğŸ“š VocabApp</a>
      <div class="nav-links" style="display:flex;gap:1rem;align-items:center;">
        <a href="/dashboard" style="color:#fff;text-decoration:none;">ğŸ“Š Dashboard</a>
        <a href="/" style="color:#fff;text-decoration:none;">ğŸ“¤ Upload</a>
        <a href="/sets" style="color:#fff;text-decoration:none;">ğŸ“– Bá»™ tá»« cá»§a tÃ´i</a>
        <span class="user-badge">ğŸ‘¤ {{ username }}</span>
        <a href="/logout" style="color: #fca5a5;">ÄÄƒng xuáº¥t</a>
      </div>
    </div>
  </header>
  
  <div class="container">
    <div class="header-card">
      <h1>ğŸ“– {{ vset.name }}</h1>
      <p class="description">{{ vset.description or 'KhÃ´ng cÃ³ mÃ´ táº£' }}</p>
      <p class="meta"><strong>NgÃ´n ngá»¯:</strong> {{ vset.language_from }} â†’ {{ vset.language_to }}</p>
      
      <div class="actions">
  <a href="/sets" class="btn btn-ghost">â† Quay láº¡i</a>
  <a href="/study/{{ vset.id }}?mode=select" class="btn">ğŸ¯ Há»c ngay</a>
  <a href="/sets/{{ vset.id }}/export?format=csv" class="btn" style="background: linear-gradient(90deg,#06b6d4,#0ea5e9);">ğŸ’¾ Export CSV</a>
  <a href="/sets/{{ vset.id }}/export?format=xlsx" class="btn" style="background: linear-gradient(90deg,#8b5cf6,#a78bfa);">ğŸ“Š Export Excel</a>
  <a href="/sets/{{ vset.id }}/edit" class="btn" style="background: linear-gradient(90deg,#f59e0b,#fbbf24);">âœï¸ Sá»­a bá»™ tá»«</a>
        <form method="post" action="/sets/{{ vset.id }}/delete" style="display:inline;" 
              onsubmit="return confirm('âš ï¸ XÃ³a bá»™ tá»« nÃ y vÃ  Táº¤T Cáº¢ tá»« vá»±ng bÃªn trong?\n\nHÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c!');">
          <button type="submit" class="btn btn-danger">ğŸ—‘ï¸ XÃ³a bá»™ tá»«</button>
        </form>
      </div>
    </div>

    <div class="section">
      <h2>â• ThÃªm tá»« má»›i</h2>
      <form method="post" action="/sets/{{ vset.id }}/add-term" class="add-term-form">
        <div class="form-row">
          <div class="form-group">
            <label>Tá»« vá»±ng *</label>
            <input type="text" name="term" required placeholder="VÃ­ dá»¥: window shopping" />
          </div>
          <div class="form-group">
            <label>Loáº¡i tá»«</label>
            <input type="text" name="pos" placeholder="n., v., adj., ..." />
          </div>
          <div class="form-group">
            <label>NghÄ©a *</label>
            <input type="text" name="definition" required placeholder="Äi dáº¡o ngáº¯m Ä‘á»“..." />
          </div>
        </div>
        <div class="form-group">
          <label>VÃ­ dá»¥ (khÃ´ng báº¯t buá»™c)</label>
          <textarea name="example" placeholder="CÃ¢u vÃ­ dá»¥ sá»­ dá»¥ng tá»« nÃ y..."></textarea>
        </div>
        <button type="submit" class="btn btn-success" style="margin-top: 1rem;">â• ThÃªm tá»«</button>
      </form>

      <h2>ğŸ“š Danh sÃ¡ch tá»« vá»±ng ({{ terms|length }})</h2>
      
      <div style="margin-bottom: 1rem;">
        <input type="text" id="searchTerms" placeholder="ğŸ” TÃ¬m kiáº¿m tá»« vá»±ng..." 
               style="width: 100%; padding: 0.7rem 1rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.95rem;"
               onkeyup="filterTerms()" />
      </div>
      
      <!doctype html>
      <html lang="vi">
      <head>
        <meta charset="utf-8" />
        <title>Chi tiáº¿t bá»™ tá»«</title>
        <link rel="stylesheet" href="/static/base.css">
        <style>
          .container { max-width: 1100px; margin: 0 auto; padding: 1rem 1.25rem 2rem; }
          table { width: 100%; border-collapse: collapse; margin-top: .5rem; }
          th, td { padding: .55rem .65rem; border-bottom: 1px solid var(--border); text-align:left; vertical-align:top; }
          th { background: var(--panel); font-weight:600; font-size:.8rem; letter-spacing:.03em; }
          tr:hover { background: var(--panel-hover); }
          .term-actions { display:flex; gap:.4rem; flex-wrap:wrap; }
          .top-actions { display:flex; gap:.6rem; flex-wrap:wrap; margin:1rem 0 1.1rem; }
          .status-col span { font-size:.65rem; }
        </style>
      </head>
      <body>
        <header>
          <div style="display:flex;align-items:center;justify-content:space-between;gap:1rem;">
            <div style="display:flex;align-items:center;gap:.6rem;font-weight:700;">
              <a href="/" style="color:#fff;">VocabApp</a>
            </div>
            <nav style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap;">
              <a href="/dashboard">Dashboard</a>
              <a href="/">Upload</a>
              <a href="/sets">Bá»™ tá»«</a>
              <span class="badge badge-info" style="background:rgba(255,255,255,0.25);border-color:rgba(255,255,255,0.35);color:#fff;">ğŸ‘¤ {{ username }}</span>
              <a href="/logout" style="color:#fee2e2;">ÄÄƒng xuáº¥t</a>
              <button class="btn-ghost" onclick="toggleTheme()" title="Äá»•i giao diá»‡n">Giao diá»‡n</button>
            </nav>
          </div>
        </header>
        <div class="container">
          <div class="header-card" style="margin:1rem 0 .75rem;">
            <h1 style="margin:0 0 .35rem;">{{ set.name }}</h1>
            <p class="muted" style="margin:0;">{{ set.description }}</p>
          </div>
          <div class="top-actions">
            <a href="/study/{{ set.id }}?mode=select" class="btn">Há»c (tá»± do)</a>
            <a href="/study/{{ set.id }}?mode=choice" class="btn-ghost">Tráº¯c nghiá»‡m</a>
            <a href="/study/{{ set.id }}?mode=fill" class="btn-ghost">Äiá»n khuyáº¿t</a>
            <a href="/sets/{{ set.id }}/edit" class="btn-ghost">Sá»­a bá»™ tá»«</a>
            <a href="/" class="btn-ghost">Táº£i bá»™ má»›i</a>
            <a href="/sets" class="btn-ghost">Quay láº¡i danh sÃ¡ch</a>
          </div>
          <div class="card" style="margin-bottom:1rem;">
            <div style="display:flex;flex-wrap:wrap;gap:1.25rem;">
              <div>
                <div class="muted" style="font-size:.7rem;text-transform:uppercase;letter-spacing:.05em;">NgÃ´n ngá»¯</div>
                <div style="font-weight:600;margin-top:.25rem;">{{ set.language_from }} â†’ {{ set.language_to }}</div>
              </div>
              <div>
                <div class="muted" style="font-size:.7rem;text-transform:uppercase;letter-spacing:.05em;">Tá»•ng sá»‘ thuáº­t ngá»¯</div>
                <div style="font-weight:600;margin-top:.25rem;">{{ terms|length }}</div>
              </div>
            </div>
          </div>
    
          {% if terms %}
          <div class="card" style="overflow-x:auto;">
            <table>
              <thead>
                <tr>
                  <th style="width:18%;">Thuáº­t ngá»¯</th>
                  <th style="width:32%;">Äá»‹nh nghÄ©a</th>
                  <th style="width:20%;">VÃ­ dá»¥</th>
                  <th style="width:15%;">Ghi chÃº</th>
                  <th style="width:7%;">Tráº¡ng thÃ¡i</th>
                  <th style="width:8%;">HÃ nh Ä‘á»™ng</th>
                </tr>
              </thead>
              <tbody>
                {% for t in terms %}
                <tr>
                  <td style="font-weight:600;">{{ t.term }}</td>
                  <td>{{ t.definition }}</td>
                  <td style="font-size:.8rem;color:var(--text-muted);">{{ t.example }}</td>
                  <td style="font-size:.8rem;color:var(--text-muted);">{{ t.note }}</td>
                  <td class="status-col">{% if t.status %}<span class="badge badge-success">{{ t.status }}</span>{% else %}<span class="badge">ChÆ°a rÃµ</span>{% endif %}</td>
                  <td>
                    <div class="term-actions">
                      <a href="/sets/{{ set.id }}/terms/{{ t.id }}/edit" class="btn-ghost">Sá»­a</a>
                      <a href="/study/{{ set.id }}?mode=select&focus={{ t.id }}" class="btn-ghost">Há»c</a>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state">
            <p>ChÆ°a cÃ³ thuáº­t ngá»¯ nÃ o trong bá»™ tá»« nÃ y.</p>
          </div>
          {% endif %}
        </div>
    </div>
    
    <div class="ai-content">
      <!-- Translate Tab -->
      <div class="ai-tab-content active" id="tab-translate">
        <div class="ai-input-group">
          <label>VÄƒn báº£n cáº§n dá»‹ch:</label>
          <textarea id="translateText" placeholder="Nháº­p tá»« hoáº·c cÃ¢u..."></textarea>
        </div>
        <div class="ai-input-group">
          <label>HÆ°á»›ng dá»‹ch:</label>
          <select id="translateDir">
            <option value="en-vi">Anh â†’ Viá»‡t</option>
            <option value="vi-en">Viá»‡t â†’ Anh</option>
          </select>
        </div>
        <button class="ai-btn" onclick="doTranslate()">Dá»‹ch ngay</button>
        <div class="ai-result" id="translateResult"></div>
      </div>
      
      <!-- Grammar Tab -->
      <div class="ai-tab-content" id="tab-grammar">
        <div class="ai-input-group">
          <label>VÄƒn báº£n cáº§n kiá»ƒm tra:</label>
          <textarea id="grammarText" placeholder="Nháº­p cÃ¢u tiáº¿ng Anh..."></textarea>
        </div>
        <button class="ai-btn" onclick="doGrammar()">Kiá»ƒm tra ngá»¯ phÃ¡p</button>
        <div class="ai-result" id="grammarResult"></div>
      </div>
      
      <!-- Example Tab -->
      <div class="ai-tab-content" id="tab-example">
        <div class="ai-input-group">
          <label>Tá»« vá»±ng:</label>
          <input type="text" id="exampleWord" placeholder="VÃ­ dá»¥: happy" />
        </div>
        <div class="ai-input-group">
          <label>Loáº¡i tá»« (tÃ¹y chá»n):</label>
          <input type="text" id="examplePos" placeholder="VÃ­ dá»¥: adj" />
        </div>
        <button class="ai-btn" onclick="doExample()">Táº¡o cÃ¢u vÃ­ dá»¥</button>
        <div class="ai-result" id="exampleResult"></div>
      </div>

      <!-- Synonyms Tab -->
      <div class="ai-tab-content" id="tab-synonyms">
        <div class="ai-input-group">
          <label>Tá»« vá»±ng:</label>
          <input type="text" id="synWord" placeholder="VÃ­ dá»¥: big" />
        </div>
        <div class="ai-input-group">
          <label>NgÃ´n ngá»¯:</label>
          <select id="synLang">
            <option value="en">Tiáº¿ng Anh</option>
            <option value="vi">Tiáº¿ng Viá»‡t</option>
          </select>
        </div>
        <button class="ai-btn" onclick="doSynonyms()">TÃ¬m tá»« Ä‘á»“ng nghÄ©a</button>
        <div class="ai-result" id="synResult"></div>
      </div>

      <!-- Antonyms Tab -->
      <div class="ai-tab-content" id="tab-antonyms">
        <div class="ai-input-group">
          <label>Tá»« vá»±ng:</label>
          <input type="text" id="antWord" placeholder="VÃ­ dá»¥: big" />
        </div>
        <div class="ai-input-group">
          <label>NgÃ´n ngá»¯:</label>
          <select id="antLang">
            <option value="en">Tiáº¿ng Anh</option>
            <option value="vi">Tiáº¿ng Viá»‡t</option>
          </select>
        </div>
        <button class="ai-btn" onclick="doAntonyms()">TÃ¬m tá»« trÃ¡i nghÄ©a</button>
        <div class="ai-result" id="antResult"></div>
      </div>
    </div>
  </div>
  
  <script>
    // AI Assistant Functions
    function toggleAI() {
      document.getElementById('aiPanel').classList.toggle('active');
    }
    
    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.ai-tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      
      // Update tab content
      document.querySelectorAll('.ai-tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');
    }
    
    async function doTranslate() {
      const text = document.getElementById('translateText').value.trim();
      const dir = document.getElementById('translateDir').value;
      const resultDiv = document.getElementById('translateResult');
      
      if (!text) {
        resultDiv.innerHTML = '<div class="ai-error">Vui lÃ²ng nháº­p vÄƒn báº£n!</div>';
        resultDiv.classList.add('show');
        return;
      }
      
      const [fromLang, toLang] = dir.split('-');
      
      resultDiv.innerHTML = '<div class="ai-loading">â³ Äang dá»‹ch...</div>';
      resultDiv.classList.add('show');
      
      try {
        const response = await fetch('/api/ai/translate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text, from_lang: fromLang, to_lang: toLang })
        });
        
        const data = await response.json();
        
        if (data.success) {
          resultDiv.innerHTML = `
            <div class=\"ai-result-label\">ğŸ“ Báº£n dá»‹ch <span class=\"badge\">${data.provider || 'ai'}</span>:</div>
            <div class=\"ai-result-text\">${data.translation}</div>
          `;
        } else {
          resultDiv.innerHTML = `<div class="ai-error">âŒ ${data.error}</div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="ai-error">âŒ Lá»—i káº¿t ná»‘i: ${error.message}</div>`;
      }
    }
    
    async function doGrammar() {
      const text = document.getElementById('grammarText').value.trim();
      const resultDiv = document.getElementById('grammarResult');
      
      if (!text) {
        resultDiv.innerHTML = '<div class="ai-error">Vui lÃ²ng nháº­p vÄƒn báº£n!</div>';
        resultDiv.classList.add('show');
        return;
      }
      
      resultDiv.innerHTML = '<div class="ai-loading">â³ Äang kiá»ƒm tra...</div>';
      resultDiv.classList.add('show');
      
      try {
        const response = await fetch('/api/ai/grammar', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text, language: 'en' })
        });
        
        const data = await response.json();
        
        if (data.success) {
          resultDiv.innerHTML = `
            <div class=\"ai-result-label\">âœ… Káº¿t quáº£ <span class=\"badge\">${data.provider || 'ai'}</span>:</div>
            <div class=\"ai-result-text\">${data.result.replace(/\n/g, '<br>')}</div>
          `;
        } else {
          resultDiv.innerHTML = `<div class="ai-error">âŒ ${data.error}</div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="ai-error">âŒ Lá»—i káº¿t ná»‘i: ${error.message}</div>`;
      }
    }
    
    async function doExample() {
      const word = document.getElementById('exampleWord').value.trim();
      const pos = document.getElementById('examplePos').value.trim();
      const resultDiv = document.getElementById('exampleResult');
      
      if (!word) {
        resultDiv.innerHTML = '<div class="ai-error">Vui lÃ²ng nháº­p tá»« vá»±ng!</div>';
        resultDiv.classList.add('show');
        return;
      }
      
      resultDiv.innerHTML = '<div class="ai-loading">â³ Äang táº¡o vÃ­ dá»¥...</div>';
      resultDiv.classList.add('show');
      
      try {
        const response = await fetch('/api/ai/example', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ word, pos: pos || null })
        });
        
        const data = await response.json();
        
        if (data.success) {
          resultDiv.innerHTML = `
            <div class=\"ai-result-label\">ğŸ’¡ CÃ¢u vÃ­ dá»¥ <span class=\"badge\">${data.provider || 'ai'}</span>:</div>
            <div class=\"ai-result-text\">${data.example}</div>
          `;
        } else {
          resultDiv.innerHTML = `<div class="ai-error">âŒ ${data.error}</div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="ai-error">âŒ Lá»—i káº¿t ná»‘i: ${error.message}</div>`;
      }
    }

    async function doSynonyms() {
      const word = document.getElementById('synWord').value.trim();
      const language = document.getElementById('synLang').value;
      const resultDiv = document.getElementById('synResult');
      if (!word) { resultDiv.innerHTML = '<div class="ai-error">Vui lÃ²ng nháº­p tá»«!</div>'; resultDiv.classList.add('show'); return; }
      resultDiv.innerHTML = '<div class="ai-loading">â³ Äang tÃ¬m...</div>'; resultDiv.classList.add('show');
      try {
        const res = await fetch('/api/ai/synonyms', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ word, language, translate_to: 'vi' }) });
        const data = await res.json();
        if (data.success) {
          const list = (data.synonyms || []).map(it => it.vi ? `${it.en} â€” <em>${it.vi}</em>` : it.en);
          resultDiv.innerHTML = `<div class="ai-result-label">ğŸ” Äá»“ng nghÄ©a (${data.provider || 'ai'}):</div><div class="ai-result-text">${list.join(', ') || 'KhÃ´ng cÃ³ káº¿t quáº£'}</div>`;
        } else { resultDiv.innerHTML = `<div class="ai-error">âŒ ${data.error}</div>`; }
      } catch (e) { resultDiv.innerHTML = `<div class="ai-error">âŒ ${e.message}</div>`; }
    }

    async function doAntonyms() {
      const word = document.getElementById('antWord').value.trim();
      const language = document.getElementById('antLang').value;
      const resultDiv = document.getElementById('antResult');
      if (!word) { resultDiv.innerHTML = '<div class="ai-error">Vui lÃ²ng nháº­p tá»«!</div>'; resultDiv.classList.add('show'); return; }
      resultDiv.innerHTML = '<div class="ai-loading">â³ Äang tÃ¬m...</div>'; resultDiv.classList.add('show');
      try {
        const res = await fetch('/api/ai/antonyms', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ word, language, translate_to: 'vi' }) });
        const data = await res.json();
        if (data.success) {
          const list = (data.antonyms || []).map(it => it.vi ? `${it.en} â€” <em>${it.vi}</em>` : it.en);
          resultDiv.innerHTML = `<div class="ai-result-label">â†”ï¸ TrÃ¡i nghÄ©a (${data.provider || 'ai'}):</div><div class="ai-result-text">${list.join(', ') || 'KhÃ´ng cÃ³ káº¿t quáº£'}</div>`;
        } else { resultDiv.innerHTML = `<div class="ai-error">âŒ ${data.error}</div>`; }
      } catch (e) { resultDiv.innerHTML = `<div class="ai-error">âŒ ${e.message}</div>`; }
    }
  </script>
</body>
</html>
